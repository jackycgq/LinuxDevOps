运维的监控系统发来通知，报告一台服务器空间满了，登陆服务 器查看，根分区确实没有空间了，如下图所示:  
这里首先说明一下服务器的一些删除策略，由于 Linux 没有回收 站功能，我们的线上服务器所有要删除的文件都会首先移动到系 统/tmp 目录下，然后定期清除/tmp 目录下的数据。这个策略本 身没有问题，但是通过检查发现这台服务器的系统分区中并没有 单独划分/tmp 分区，这样/tmp 下的数据其实是占用了根分区的 空间。既然找到了问题，那么删除/tmp 目录下一些大数据即可， 执行如下命令，检查/tmp 下最大的三个数据文件，如下图所示:
1[root@localhost~  ]#  du  -s  /tmp/*|sort  -nr|head  -
23
369206016  /tmp/access_log
436  /tmp/hsperfdata_root
36 /tmp/hsperfdata_mapred
通过命令输出发现在/tmp 目录下有个 66G 大小的文件 access_log，这个文件应该是 apache 产生的访问日志文件，从 日志大小来看，应该是很久没有清理 apache 日志文件了，基本 判定是这个文件导致的根空间爆满，在确认此文件可以删除后，
 
执行如下删除操作:
[root@localhost ~]# rm /tmp/access_log 接着查看系统根分区空间是否释放，如下图所示:
从输出可以看到，根分区空间仍然没有释放，这是怎么回事?

2、解决思路
一般说来不会出现删除文件后空间不释放的情况，但是也存在例 外，比如文件被进程锁定，或者有进程一直在向这个文件写数据
 
等等，要理解这个问题，就需要知道 Linux 下文件的存储机制和 存储结构。 一个文件在文件系统中的存放分为两个部分:数据部分和指针部 分，指针位于文件系统的 meta-data 中，数据被删除后，这个指 针就从 meta-data 中清除了，而数据部分存储在磁盘中，数据对

 应的指针从 meta-data 中清除后，文件数据部分占用的空间就可 以被覆盖并写入新的内容，之所以出现删除 access_log 文件后， 空间还没释放，就是因为 httpd 进程还在一直向这个文件写入内 容，导致虽然删除了 access_log 文件，但文件对应的指针部分 由于进程锁定，并未从 meta-data 中清除，而由于指针并未被删 除，那么系统内核就认为文件并未被删除，因此通过 df 命令查 询空间并未释放也就不足为奇了。
 
 
 3、问题排查
既然有了解决问题的思路，那么接下来看看是否有进程一直在向 acess.log 文件中写数据，这里需要用到 Linux 下的 lsof 命令， 通过这个命令可以获取一个已经被删除但仍然被应用程序占用 的文件列表，命令执行如下图所示:
 
